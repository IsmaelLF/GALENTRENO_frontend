---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="GALENTRENO">
  <h1 id="user-greeting">Ola!</h1>
  <small id="current-date"></small>

  <div class="stats-grid">
    <div class="card"><strong>--</strong><br />Entrenamientos</div>
    <div class="card"><strong>--</strong><br />Volume total</div>
    <div class="card"><strong>--</strong><br />Esta semana</div>
  </div>

  <button class="primary">+ Novo Entrenamento</button>

  <button id="logout-button" style="width: 100%; margin-top: 1rem;"
    >Cerrar Sesión</button
  >

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const token = localStorage.getItem("jwt_token");

      // --- Protección de la ruta ---
      if (!token) {
        window.location.href = "/login";
        return;
      }

      // --- Lógica para mostrar la fecha ---
      const dateElement = document.getElementById("current-date");
      const today = new Date();
      dateElement.textContent = today.toLocaleDateString("es-ES", {
        weekday: "long",
        day: "numeric",
        month: "long",
      });

      try {
        const response = await fetch(
          "http://localhost:3000/api/sesions/recentes",
          {
            headers: { Authorization: `Bearer ${token}` },
          }
        );

        if (response.ok) {
          const data = await response.json();
          document.getElementById("user-greeting").textContent =
            `Ola, ${data.nomeUsuario}!`;
        } else {
          document.getElementById("user-greeting").textContent = "Ola!";
        }
      } catch (error) {
        console.error("Error al obtener datos del usuario:", error);
      }
    });

    document.getElementById("logout-button").addEventListener("click", () => {
      localStorage.removeItem("jwt_token");
      window.location.href = "/login";
    });
  </script>
</BaseLayout>
